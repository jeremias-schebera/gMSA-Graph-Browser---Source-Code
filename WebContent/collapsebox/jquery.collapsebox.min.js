!function($){$.fn.collapsebox=function(configs){if(configs&&("left"==(configs=$.extend({fulcrumX:"left",spaceX:0,fulcrumY:"top",spaceY:0,zIndex:9999,opacity:1,handle:null,button:null,action:"click",speed:300,easing:"swing",openButtonClass:"collapsebox-open",closeButtonClass:"collapsebox-close",openBeforeFunc:null,openAfterFunc:null,closeBeforeFunc:null,closeAfterFunc:null,draggable:!1},configs)).fulcrumX||"right"==configs.fulcrumX)&&("top"==configs.fulcrumY||"bottom"==configs.fulcrumY)&&"number"==typeof configs.spaceX&&"number"==typeof configs.spaceY&&(configs.button||configs.handle)){var selectors={container:this,button:configs.button.nodeType?configs.button:$(configs.button,this),handle:configs.handle.nodeType?configs.handle:$(configs.handle,this),parent:$(this.parent().get(0))};if(selectors.container.length&&selectors.button.length&&selectors.handle.length&&selectors.parent.length)if("BODY"===(void 0===selectors.parent.context?selectors.parent[0].nodeName.toUpperCase():selectors.parent.context.nodeName.toUpperCase())){var open_height=0,close_height=0,is_msie6=!$.support.style&&void 0===document.documentElement.style.maxHeight,is_webkit=void 0!==$.support.checkOn?!$.support.checkOn:$.browser.safari;!function(){var cssObj={};open_height=selectors.container.height(),close_height=selectors.handle.outerHeight(!0),open_height==close_height&&(open_height=selectors.container.css({height:"",overflow:""}).height(),selectors.container.css({height:close_height,overflow:"hidden"}));if(cssObj.height=open_height+"px",!1===is_msie6)cssObj[configs.fulcrumX]=configs.spaceX,cssObj[configs.fulcrumY]=configs.spaceY,cssObj.position="fixed";else{var resizeTimer;if(setMsIe6Position(),"right"==configs.fulcrumX||"bottom"==configs.fulcrumY)$(window).resize(function(){resizeTimer&&clearTimeout(resizeTimer),resizeTimer=setTimeout(function(){setMsIe6Position()},0)});cssObj.position="absolute"}cssObj.zIndex=configs.zIndex,1!==configs.opacity&&(cssObj.opacity=configs.opacity);selectors.container.css(cssObj)}(),!0===configs.draggable&&function(){var draggableObj;draggableObj=!0===is_webkit&&!1===function(){var version=$.ui.version.split(".");if(0<parseInt(version[0])&&7<parseInt(version[1]))return!0;return!1}()?{start:function(e,ui){$(this).css("position","absolute")},stop:function(e,ui){var cssObj=getCorner();cssObj.position="fixed",$(this).css(cssObj)},containment:"html",refreshPositions:!0,handle:selectors.handle,zIndex:configs.zIndex+1,cursor:"move",scroll:!1}:!0===is_msie6?{stop:function(e,ui){var $window=$(window),offset=selectors.container.offset();"right"==configs.fulcrumX&&(configs.spaceX=$window.width()-offset.left+$window.scrollLeft()-selectors.container.outerWidth(!1)),"bottom"==configs.fulcrumY&&(configs.spaceY=$window.height()-offset.top+$window.scrollTop()-selectors.container.outerHeight(!1)),selectors.container.get(0).style.setExpression("left","eval("+(offset.left-$window.scrollLeft())+"+(document.body.scrollLeft||document.documentElement.scrollLeft))"),selectors.container.get(0).style.setExpression("top","eval("+(offset.top-$window.scrollTop())+"+(document.body.scrollTop||document.documentElement.scrollTop))")},handle:selectors.handle,zIndex:configs.zIndex+1,cursor:"move",scroll:!1}:{stop:function(e,ui){var cssObj=getCorner();cssObj.position="fixed",$(this).css(cssObj)},handle:selectors.handle,zIndex:configs.zIndex+1,cursor:"move",scroll:!1};selectors.handle.css("cursor","move"),selectors.container.draggable(draggableObj)}(),selectors.button.unbind(configs.action).bind(configs.action,function(){!function(){if(!chkReady())return;("open"==chkStatus()?function close(){if(!chkReady())return;"close"==chkStatus()&&close();disable();$.isFunction(configs.closeBeforeFunc)&&configs.closeBeforeFunc(selectors.container,selectors.handle,selectors.button);if(!1===is_msie6){var top="auto",bottom="auto";"top"==configs.fulcrumY?top=selectors.container.css("top"):(bottom=parseInt(selectors.container.css("bottom"))+(open_height-close_height),selectors.container.css({top:selectors.container.offset().top-$(window).scrollTop(),bottom:"auto"}))}selectors.button.removeClass(configs.openButtonClass+" "+configs.closeButtonClass).addClass(configs.closeButtonClass);selectors.container.css({overflow:"hidden"}).animate({height:close_height},configs.speed,configs.easing,function(){!1===is_msie6&&selectors.container.css({top:top,bottom:bottom}),$.isFunction(configs.closeAfterFunc)&&configs.closeAfterFunc(selectors.container,selectors.handle,selectors.button),enable()})}:function(){if(!chkReady())return;if("open"==chkStatus())return;disable(),$.isFunction(configs.openBeforeFunc)&&configs.openBeforeFunc(selectors.container,selectors.handle,selectors.button);if(!1===is_msie6){var top="auto",bottom="auto";"top"==configs.fulcrumY?top=selectors.container.css("top"):(bottom=parseInt(selectors.container.css("bottom"))-(open_height-close_height),selectors.container.css({top:selectors.container.offset().top-$(window).scrollTop(),bottom:"auto"}))}selectors.button.removeClass(configs.openButtonClass+" "+configs.closeButtonClass).addClass(configs.openButtonClass),selectors.container.animate({height:open_height},configs.speed,configs.easing,function(){!1===is_msie6&&selectors.container.css({height:open_height+"px",overflow:"",top:top,bottom:bottom}),$.isFunction(configs.openAfterFunc)&&configs.openAfterFunc(selectors.container,selectors.handle,selectors.button),enable()})})()}()}),enable()}}function setMsIe6Position(){var $window=$(window),spaceX=configs.spaceX,spaceY=configs.spaceY;"right"==configs.fulcrumX&&(spaceX=$window.width()-configs.spaceX-selectors.container.outerWidth(!1)),"bottom"==configs.fulcrumY&&(spaceY=$window.height()-configs.spaceY-selectors.container.outerHeight(!1)),selectors.container.get(0).style.setExpression("left","eval("+spaceX+"+(document.body.scrollLeft||document.documentElement.scrollLeft))"),selectors.container.get(0).style.setExpression("top","eval("+spaceY+"+(document.body.scrollTop||document.documentElement.scrollTop))")}function getCorner(){var $window=$(window),offset=selectors.container.offset(),position={};return"left"==configs.fulcrumX?(position[configs.fulcrumX]=offset.left-$window.scrollLeft(),position.right="auto"):(position[configs.fulcrumX]=$window.width()+$window.scrollLeft()-offset.left-selectors.container.outerWidth(!1),position.left="auto"),"top"==configs.fulcrumY?(position[configs.fulcrumY]=offset.top-$window.scrollTop(),position.bottom="auto"):(position[configs.fulcrumY]=$window.height()+$window.scrollTop()-offset.top-selectors.container.outerHeight(!1),position.top="auto"),position}function chkReady(){return selectors.button.hasClass("collapsebox-ready")}function enable(){selectors.button.removeClass("collapsebox-ready").addClass("collapsebox-ready")}function disable(){selectors.button.removeClass("collapsebox-ready")}function chkStatus(){return selectors.button.hasClass(configs.closeButtonClass)?"close":"open"}}}(jQuery);